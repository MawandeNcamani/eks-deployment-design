# .github/workflows/test-public-access.yml
name: Test Public Access
on:
  workflow_run:
    workflows: ["Deploy to Dev"]  # After dev deployment
    types: [completed]

jobs:
  test:
    if: github.event.workflow_run.conclusion == 'success'
    runs-on: ubuntu-latest
    steps:
      - name: Simulate Public Access Test
        run: |
          echo "âœ… SUCCESS: Main app deployed to dev"
          echo ""
          echo "ðŸ“¡ In production, we would now:"
          echo "1. Wait for ALB to provision (2-3 minutes)"
          echo "2. Get ALB DNS from AWS:"
          echo "   aws elbv2 describe-load-balancers \\"
          echo "     --query 'LoadBalancers[?contains(DNSName, \\'staging\\')].DNSName'"
          echo ""
          echo "3. Test endpoints:"
          echo "   curl -f https://\$ALB_DNS/health"
          echo "   curl -f https://\$ALB_DNS/api/status"
          echo ""
          echo "4. Verify microservice communication:"
          echo "   curl -f https://\$ALB_DNS/api/data"
          echo "   # This calls microservice internally"
          echo ""
          echo "ðŸŽ¯ Purpose: Catch deployment issues before manual promotion."